<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>会员查询</title>
	<link rel="stylesheet" href="./layui/css/layui.css">
	<link rel="stylesheet" href="./css/hyfind.css">
	<link rel="stylesheet" href="./css/header.css">
	<style>
	</style>
</head>

<body>
	<!-- 头部 -->
	<div class="headerpage">
		<div class="layui-container-fluid">
			<div class="layui-fluid">
				<div class="layui-row layui-col-space5">
					<div class="layui-col-md5" style="padding-right: 0px;">
						<div class="wltop">
							<div class="logo">
								<img src="./img/admin_logo.png" alt="">
							</div>
						</div>
					</div>
					<div class="layui-col-md7" style="padding-left: 0px;">
						<ul class="layui-nav layui-bg-blue tou">
							<li class="layui-nav-item layui-this"><a href="">首页</a></li>
							<li class="layui-nav-item">
								<a href="javascript:;">志愿者管理</a>
								<dl class="layui-nav-child">
									<dd><a href="">理事调整</a></dd>
									<dd><a href="">增补会员单位</a></dd>
									<dd><a href="">电商平台</a></dd>
								</dl>
							</li>
							<li class="layui-nav-item">
								<a href="javascript:;">组织管理</a>
								<dl class="layui-nav-child">
									<dd><a href="">移动模块</a></dd>
									<dd><a href="">后台模版</a></dd>
									<dd><a href="">电商平台</a></dd>
								</dl>
							</li>
							<li class="layui-nav-item">
								<a href="javascript:;">活动管理</a>
								<dl class="layui-nav-child">
									<dd><a href="">移动模块</a></dd>
									<dd><a href="">后台模版</a></dd>
									<dd><a href="">电商平台</a></dd>
								</dl>
							</li>
							<li class="layui-nav-item">
								<a href="javascript:;">会员管理</a>
								<dl class="layui-nav-child">
									<dd><a href="#">会员查询</a></dd>
									<dd><a href="./vipcheck.html">审核管理</a></dd>
									<dd><a href="./recommendedUnits.html">推荐单位管理</a></dd>
									<dd><a href="./vipduty.html">会员职位管理</a></dd>
									<dd><a href="./InvitationCode.html">邀请码管理</a></dd>
									<dd><a href="">通知管理</a></dd>
									<dd><a href="">会员信息统计</a></dd>
									<dd><a href="">会费管理</a></dd>
								</dl>
							</li>
							<li class="layui-nav-item">
								<a href="javascript:;">系统管理</a>
								<dl class="layui-nav-child">
									<dd><a href="">移动模块</a></dd>
									<dd><a href="">后台模版</a></dd>
									<dd><a href="">电商平台</a></dd>
								</dl>
							</li>
							<li class="layui-nav-item">
								<a href="javascript:;">统计报表</a>
								<dl class="layui-nav-child">
									<dd><a href="">移动模块</a></dd>
									<dd><a href="">后台模版</a></dd>
									<dd><a href="">电商平台</a></dd>
								</dl>
							</li>
							<li class="layui-nav-item"><a href="">系统管理员</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- 内容 -->
	<div class="hytitle">
		<div class="hytitle_font">本协会的会员</div>
	</div>
	<div class="content">
		<div class="content_nav">
			<div class="content_navl"><span><i class="layui-icon layui-icon-home"></i>首页&nbsp;&nbsp;</span>/<span>&nbsp;会员管理&nbsp;&nbsp;</span>/&nbsp;会员查询</div>
			<div class="content_navi">
				<form class="layui-form" action="">
					<div class="layui-container-fluid">
						<div class="layui-fluid">
							<div class="layui-row">
								<div class="layui-col-md3">
									<div class="grid-demo grid-demo-bg1">
										<label for="">会员姓名：
											<div>
												<input type="text" placeholder="会员姓名" id="vipname">
											</div>
										</label>
									</div>
								</div>
								<div class="layui-col-md3">
									<div class="grid-demo">
										<label for="">会员编号：
											<div>
												<input type="text" placeholder="会员编号" id="vipnumber">
											</div>
										</label>
									</div>
								</div>
								<div class="layui-col-md3">
									<div class="grid-demo grid-demo-bg1">
										<label for="">艺术门类：
											<div>
												<select id="yishu"name="modules" lay-verify="required" lay-search="" id="arttype"lay-filter="yishu">
													<option value="">请选择</option>
													<!-- <option value="1">layer</option>
													<option value="2">form</option>
													<option value="3">layim</option> -->
												</select>
											</div>
										</label>
									</div>
								</div>
								<div class="layui-col-md3">
										<div class="grid-demo grid-demo-bg1">
												<label for="">地域：
													<div>
														<div class="layui-input-block">
															<input type="text" name="title" lay-verify="title" id="szd"
																autocomplete="off" placeholder="现所在地" class="layui-input">
															</div>
															<div id="test1"></div>
													</div>
												</label>
											</div>
								</div>
								<div class="layui-col-md12">
										<div class="layui-col-md4">
												<div class="grid-demo">
													<label for="">入会日期：
														<div>
															<div class="layui-input-inline">
																	<div class="date_font date_tubiao"><i class="layui-icon layui-icon-date"></i></div>
																<input type="text" name="date" id="time1" lay-verify="date"
																	style="width:122px;display: inline-block" placeholder="开始时间"
																	autocomplete="off" class="layui-input">
																<div class="date_font z_tubiao">至</div> 
																<input type="text" name="date" id="time2" lay-verify="date"
																	style="width:122px;display: inline-block" placeholder="结束时间"
																	autocomplete="off" class="layui-input">
																<div class="date_font date_tubiao2"><i class="layui-icon layui-icon-refresh-1"></i></div>	
															</div>
														</div>
													</label>
												</div>
										</div>
										<div class="layui-col-md4">
												<div class="grid-demo">
													<label for="">推荐单位：
														<div>
															<input type="text" placeholder="推荐单位" id="tjdw">
														</div>
													</label>
												</div>
											</div>
											<div class="layui-col-md4">
												<div class="grid-demo">
													<label for="">组织身份：
														<div>
															<select name="modules" lay-verify="required" lay-search="" id="zzsf">
																<option value="">请选择</option>
																<option value="1">aaaa</option>
																<option value="2">bbb</option>
																<option value="3">ccc</option>
															</select>
														</div>
													</label>
												</div>
											</div>
								</div>

							</div>
						</div>
					</div>
				</form>
			</div>
			<div class="hy_btn">
				<button type="button" class="layui-btn layui-btn-normal" id="btnclear"style="background-color: grey;">清空条件</button>
				<button type="button" class="layui-btn layui-btn-normal">通讯录导出</button>
				<a href="./newvip.html"><button type="button" class="layui-btn layui-btn-normal">新增</button></a>
				<button type="button" class="layui-btn layui-btn-normal" onclick="tjfind()">查询</button>
				<div class="clear"></div>
			</div>
			<div class="findres">
				<button type="button" class="layui-btn layui-btn-normal">批量导出</button>
				<table class="layui-table" lay-skin="line">
					<colgroup>
						<col width="150">
						<col width="200">
						<col>
					</colgroup>
					<thead>
						<tr class="tatou">
							<th style="width: 50px">
								<input type="checkbox" name="" title="" lay-skin="primary">
							</th>
							<th>平台编号</th>
							<th>会员编号</th>
							<th>会员姓名</th>
							<th>入会日期</th>
							<th>推荐单位</th>
							<th>组织身份</th>
							<th>艺术门类</th>
							<th>地域</th>
							<th>操作</th>
						</tr>
					</thead>
					<tbody id='tb'>

					</tbody>
				</table>
				<div>
					<div id="layui"></div>
				</div>
			</div>
		</div>
	</div>


	<script src="./layui/layui.js"></script>
	<script src="./js/layuicommon.js"></script>
	<script src="./js/jquery.min.js"></script>
	<script src="./js/header.js"></script>
	<script src="./js/common.js"></script>
	<script src="./js/hyfind.js"></script>
	<script>
		$(".tatou").css({ "background-color": "#059afe", "color": "white" });
		// layui.use('laypage', function () {
		// 	var laypage = layui.laypage;

		// 	//执行一个laypage实例
		// 	laypage.render({
		// 		elem: 'shuju' //注意，这里的 test1 是 ID，不用加 # 号
		// 		, count: 5 //数据总数，从服务端得到
		// 		, limit: 1
		// 	});
		// });
		let treedata = [];
		function wtf(data) {
            data.map((v, i) => {
                let obj = {};
                obj.title = v.areaName;
                obj.id = i;
                obj.children = [];
                v.childList.map((val, ind) => {
                    let objc = {};
                    objc.title = val.areaName;
                    objc.id = i+'-'+ind;
                    objc.children = [];
                    val.childList.map((vv, ii) => {
                        let objcc = {};
                        objcc.title = vv.areaName;
                        objcc.id = i+'-'+ind + '-' + ii;
                        objc.children.push(objcc);
                    })
                    obj.children.push(objc);
                });
                treedata.push(obj);
            });
        }
        var data = {
        }
        base.commonAjax('clav/area/getAddressList', data, function (data) {
            if (data.code == 1) {
                //console.log("z", data);
                wtf(data.data);
               // console.log(treedata)
                layui.use('tree', function () {
                    var tree = layui.tree;

                    //渲染
                    var inst1 = tree.render({
                        elem: '#test1'  //绑定元素
                        ,click: function(obj){
                       // console.log(obj.data); //得到当前点击的节点数据
                       // console.log(obj.elem); //得到当前节点元素 
                        // console.log($('.layui-tree-set').attr("data-id"));
                      //  console.log(obj.data.id); //得到当前点击的节点数据
                        let str = obj.data.id;
                       // console.log(str.indexOf('-')>-1);
                         if(str.indexOf('-')>-1 && str.indexOf('-')){
                            let arr = str.split('-');
                            if(arr.length == 3){
                               // console.log(arr);
                       // console.log(treedata[arr[0]].title);
                       // console.log(treedata[arr[0]].title);
                       // console.log(obj.data.title);
                        var place=treedata[arr[0]].title+"-"+treedata[arr[0]].title+"-"+obj.data.title;
                        //console.log("地区",place);
                        $('#szd').val(place);
                        $('#test1').css("visibility","hidden");
                            }
                         }
                    }
                        , data:treedata
                    });
                    
                });
            }
        });

function findvip(name,memberNo,artTypeId,location,orgIdentityId){
	var name;
	var memberNo;
	var artTypeId;
	var location;
	var orgIdentityId;
	var data = {
		name:name,
		memberNo:memberNo,
		artTypeId:artTypeId,
		location:location,
		orgIdentityId:orgIdentityId
	}
		base.commonAjax('clav/member/getClavMemberList', data, function (data) {
			var pagedata = [];
			console.log(data);
			pagedata = data.data;
			//console.log(pagedata)

			//调用分页
			layui.use(['laypage', 'layer'], function () {
				var laypage = layui.laypage
					, layer = layui.layer;

				laypage.render({
					elem: 'layui'
					, count: pagedata.length,
					layout: ['count', 'prev', 'page', 'next', 'limit','skip'],
					limit: 10,
					jump: function (obj) {
						//模拟渲染
						document.getElementById('tb').innerHTML = function () {
							var arr = []
								, thisData = pagedata.concat().splice(obj.curr * obj.limit - obj.limit, obj.limit);
							layui.each(thisData, function (index, item) {
								arr.push(auto(item));
								//console.log(item);
							});
							return arr.join('');
						}();
					}
				});
			});
		});
	}
	findvip();
	layui.use('form', function(){
          var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功
       form.on('select(yishu)',function(data){
		category=data.value;
		yishu=data.elem[data.elem.selectedIndex].text;
           form.render('select');
	   })
	})
	function tjfind(){
		var name;
		var memberNo;
		//console.log( $("#vipname").val())
		//console.log( $("#vipnumber").val())
		//console.log( $("#szd").val())
		if ($("#vipname").val()!='') {
			name=$("#vipname").val();
		} 	
		if ($("#vipnumber").val()!='') {
			memberNo=$("#vipnumber").val();	
		} 
		 //location=$("#szd").val();
		 //console.log(category)
		 //artTypeId=category
		findvip(name,memberNo);
	}
	function auto(obj){
		return '<tr>' +
				'<td style="width: 50px">' +
				'<input type="checkbox" name="" title="" lay-skin="primary">' +
				'</td>' +
				'<td>' + 123 + '</td>' +
				'<td>' + obj.memberNo + '</td>' +
				'<td>' + obj.name + '</td>' +
				'<td>' + obj.createDate + '</td>' +
				'<td>' + obj.recommendType + '</td>' +
				'<td>' + obj.orgIdentityId + '</td>' +
				'<td>' + obj.artTypeId + '</td>' +
				'<td>' + obj.location + '</td>' +
				'<td>' +
				'<button class="layui-btn">编辑</button>' +
				'<button class="layui-btn layui-btn-normal">查看</button>' +
				'<button class="layui-btn layui-btn-normal">导出</button>' +
				'<button class="layui-btn layui-btn-warm">移除</button>' +
				'<button class="layui-btn layui-btn-danger">重置密码</button>' +
				'</td>' +
				'</tr>'
	}




	$('#szd').click(function(){
            $('#test1').css("visibility","visible");
        })
	$('#btnclear').click(function(){
		$('#vipname,#vipnumber,#arttype,#szd,#time1,#time2,#tjdw,#zzsf').val('');
		//$('#arttype,#zzsf').empty();
		//form.render("select");
	})
	layui.use('form', function(){
          var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功
	form.on('#btnclear',function(elem){
     //执行清空
    $("#arttype").empty();
    form.render();
	});

})
	</script>
</body>

</html>