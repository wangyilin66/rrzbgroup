<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>邀请码管理</title>
    <link rel="stylesheet" href="./layui/css/layui.css">
    <link rel="stylesheet" href="./css/InvitationCode.css">
    <link rel="stylesheet" href="./css/header.css">
    <style>
    .content{
    background-color:#eceff4;
    height:auto;
    padding-bottom: 50px;
}
#test1{
    height: 102px;
    overflow: auto;
    width: 303px;
    position: absolute;
    left: 3px;
    top: 63px;
    background-color: white;
    z-index: 999;
    border: solid rgba(222,225,230,0.3);
    visibility: hidden;
    border-radius: 6px;
    visibility:hidden;
}
</style>
</head>

<body>
  	<!-- 头部 -->
	<div class="headerpage">
          
        </div>
    <!-- 内容 -->
    <div class="hytitle">
        <div class="hytitle_font" style="border-bottom: solid">发展名额分配</div>
        <div class="hytitle_font">邀请码生产</div>
        <div class="hytitle_font">组织邀请码申请</div>
        <div class="hytitle_font">邀请码补领</div>
        <div class="hytitle_font">邀请码状况跟踪管控</div>
        <div class="hytitle_font">会员邀请状态跟踪</div>
    </div>
    <div class="content">
        <!--发展名额分配  -->
        <div class="content_nav">
            <div class="content_navl"><span><i
                        class="layui-icon layui-icon-home"></i>首页&nbsp;&nbsp;</span>/<span>&nbsp;会员管理&nbsp;&nbsp;</span>/&nbsp;邀请码管理
            </div>
            <div class="content_navi">
                <form class="layui-form" action="">
                    <div class="layui-container-fluid">
                        <div class="layui-fluid">
                            <div class="layui-row">
                                <div class="layui-col-sm3">
                                    <div class="grid-demo grid-demo-bg1">
                                        <label for="">发展年份：
                                            <div>
                                                <select id="nianfen" name="modules" lay-verify="required" lay-search="" lay-filter="fznf_z">
                                                    <option value="">请选择</option>
                                                    <!-- <option value="1">layer</option>
													<option value="2">form</option>
													<option value="3">layim</option> -->
                                                </select>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                                <div class="layui-col-sm3">
                                    <div class="grid-demo grid-demo-bg1">
                                        <label for="">入会日期：
                                            <div>
                                                <div class="layui-input-inline">
                                                    <div class="date_font date_tubiao"><i
                                                            class="layui-icon layui-icon-date"></i></div>
                                                    <input type="text" name="date" id="time1" lay-verify="date"
                                                        style="width:122px;display: inline-block" placeholder="开始时间"
                                                        autocomplete="off" class="layui-input">
                                                    <div class="date_font z_tubiao">至</div>
                                                    <input type="text" name="date" id="time2" lay-verify="date"
                                                        style="width:122px;display: inline-block" placeholder="结束时间"
                                                        autocomplete="off" class="layui-input">
                                                    <div class="date_font date_tubiao2" id="qkqk"><i
                                                            class="layui-icon layui-icon-refresh-1" ></i></div>
                                                </div>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                                <div class="layui-col-sm12">
                                    <div class="layui-col-sm3">
                                        <div class="grid-demo">
                                            <label for="">推荐单位/人：
                                                <div>
                                                    <input type="text" placeholder="请选择" readonly="readonly" style="border-radius: 6px;" id='sanjit' onclick="chuxian()">
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                    <div id="test1"></div>
                                    <div class="layui-col-sm3">
                                        <div class="grid-demo">
                                            <label for="">发展名额数：
                                                <div>
                                                    <input type="text" placeholder="发展名额数" style="border-radius: 6px;" id="fzmees_z">
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="layui-col-sm3 layui-col-md-offset3">
                                        <div class="hy_btn">
                                            <button type="reset" class="layui-btn layui-btn-danger">清空</button>
                                            <button type="button" class="layui-btn layui-btn-normal" onclick="qrfp_z()">确认分配</button>
                                            <div class="clear"></div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

            </div>

            <div class="findres2">
                <table class="layui-table" lay-skin="line">
                    <colgroup>
                        <col width="150">
                        <col width="200">
                        <col>
                    </colgroup>
                    <thead>
                        <tr class="tatou">
                            <th>序号</th>
                            <th>推荐类型</th>
                            <th>单位类型</th>
                            <th>单位名称</th>
                            <th id="table_count"></th>
                            <th>分配时间</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="codefenpei_z">
                        <!-- <tr>
                            <td>12313</td>
                            <td>会员单位推荐</td>
                            <td>全国文艺家协会</td>
                            <td>中国影协</td>
                            <td>7</td>
                            <td>2018-05-23 14：23：56</td>
                            <td>
                                <button class="layui-btn">修改</button>
                                <button class="layui-btn layui-btn-danger">删除</button>
                            </td>
                        </tr> -->
                    </tbody>
                </table>
                <div>
                    <div id="shuju1" style="display: flex;justify-content: space-around;"></div>
                    <div></div>
                    <div></div>
                </div>
            </div>
            </form>
        </div>
        <!-- 邀请码生产 -->
        <div class="content_nav">
            <div class="content_navl"><span><i
                        class="layui-icon layui-icon-home"></i>首页&nbsp;&nbsp;</span>/<span>&nbsp;会员管理&nbsp;&nbsp;</span>/&nbsp;邀请码管理
            </div>
            <div class="content_navi">
                <form class="layui-form" action="">
                    <div class="layui-container-fluid">
                        <div class="layui-fluid">
                            <div class="layui-row">
                                <div class="layui-col-sm3 layui-col-md-offset9">
                                    <div class="hy_btn">
                                        <button type="button" class="layui-btn layui-btn-normal">一键生成</button>
                                        <div class="clear"></div>
                                    </div>
                                </div>


                            </div>
                        </div>
                    </div>

            </div>

            <div class="findres">
                <button type="button" class="layui-btn layui-btn-normal">批量导出</button>
                <table class="layui-table" lay-skin="line">
                    <colgroup>
                        <col width="150">
                        <col width="200">
                        <col>
                    </colgroup>
                    <thead>
                        <tr class="tatou">
                            <th style="width: 50px">
                                <input type="checkbox" name="" title="" lay-skin="primary">
                            </th>
                            <th>序号</th>
                            <th>推荐类型</th>
                            <th>单位类型</th>
                            <th>推荐单位/人</th>
                            <th>邀请码</th>
                        </tr>
                    </thead>
                    <tbody id="sccode_z">                       
                    </tbody>
                </table>
                <div>
                    <div id="shuju2" style="display: flex;justify-content: space-around;"></div>
                </div>
            </div>
            <div class="yqm_btn">
                <button type="button" class="layui-btn layui-btn-normal">完成并下载</button>
                <button type="button" class="layui-btn layui-btn-danger">全部邀请码重新生成</button>
            </div>
            </form>
        </div>
        <!--组织邀请码申请  -->
        <div class="content_nav">
            <div class="content_navl"><span><i
                        class="layui-icon layui-icon-home"></i>首页&nbsp;&nbsp;</span>/<span>&nbsp;会员管理&nbsp;&nbsp;</span>/&nbsp;邀请码管理
            </div>
            <div class="content_navi">
                <form class="layui-form" action="">
                    <div class="layui-container-fluid">
                        <div class="layui-fluid">
                            <div class="layui-row">
                                <div class="layui-col-sm3">
                                    <div class="grid-demo grid-demo-bg1">
                                        <label for="">发展年份：
                                            <div style="display: inline-block">
                                                <select id="nianfen2" name="modules" lay-verify="required" lay-search="" lay-filter="fznf_z2">
                                                    <option value="">请选择</option>
                                                    <!-- <option value="1">layer</option>
                                                                    <option value="2">form</option>
                                                                    <option value="3">layim</option> -->
                                                </select> 
                                            </div>
                                        </label>
                                    </div>
                                </div>
                                <div class="layui-col-sm3">
                                    <div class="grid-demo grid-demo-bg1">
                                        <label for="">申领推荐单位/人：
                                            <div style="display: inline-block">
                                                <select id="yishu" name="modules" lay-verify="required" lay-search="">
                                                    <option value="">请选择</option>
                                                    <!-- <option value="1">layer</option>
                                                                        <option value="2">form</option>
                                                                        <option value="3">layim</option> -->
                                                </select>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                                <div class="layui-col-sm3 layui-col-md-offset3">
                                    <div class="hy_btn">
                                        <button type="button" class="layui-btn layui-btn-normal">查询</button>
                                        <button type="button" class="layui-btn layui-btn-normal">一键申领并传播</button>
                                        <div class="clear"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>
            <div class="findres">
                <button type="button" class="layui-btn layui-btn-normal">批量导出</button>
                <table class="layui-table" lay-skin="line">
                    <colgroup>
                        <col width="150">
                        <col width="200">
                        <col>
                    </colgroup>
                    <thead>
                        <tr class="tatou">
                            <th>序号</th>
                            <th>发展年份</th>
                            <th>单位名称</th>
                            <th>发展名额数</th>
                            <th>申请状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="zzyqmsq_z">
                        
                    </tbody>
                </table>
                <div>
                    <div id="shuju3" style="display: flex;justify-content: space-around;"></div>
                </div>
            </div>
            </form>
        </div>
        <!-- 邀请码补领 -->
        <div class="content_nav">
            <div class="content_navl"><span><i
                        class="layui-icon layui-icon-home"></i>首页&nbsp;&nbsp;</span>/<span>&nbsp;会员管理&nbsp;&nbsp;</span>/&nbsp;邀请码管理
            </div>
            <div class="content_navi">
                <form class="layui-form" action="">
                    <div class="layui-container-fluid">
                        <div class="layui-fluid">
                            <div class="layui-row">
                                <div class="layui-col-sm3">
                                    <div class="grid-demo grid-demo-bg1">
                                        <label for="">发展年份：
                                            <div>
                                                <select id="yishu" name="modules" lay-verify="required" lay-search="">
                                                    <option value="">请选择</option>
                                                    <!-- <option value="1">layer</option>
                                                                        <option value="2">form</option>
                                                                        <option value="3">layim</option> -->
                                                </select>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                                <div class="layui-col-sm3">
                                    <div class="grid-demo grid-demo-bg1">
                                        <label for="">补领推荐单位/人：
                                            <div>
                                                <select id="yishu" name="modules" lay-verify="required" lay-search="">
                                                    <option value="">请选择</option>
                                                    <!-- <option value="1">layer</option>
                                                                            <option value="2">form</option>
                                                                            <option value="3">layim</option> -->
                                                </select>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                                <div class="layui-col-sm12">
                                        <div class="layui-col-sm3">
                                                <div class="grid-demo grid-demo-bg1">
                                                        <label for="">补领邀请码：
                                                            <div style="display: inline-block">
                                                                <input type="text" style="width: 36px;margin-right: 15px;margin-top: 19px;">个
                                                            </div>
                                                        </label>
                                                    </div>
                                        </div> 
                                <div class="layui-col-sm3 layui-col-md-offset6">
                                    <div class="hy_btn">
                                        <button type="button" class="layui-btn layui-btn-normal">确认补领</button>
                                        <button type="button" class="layui-btn layui-btn-normal">导出</button>
                                        <div class="clear"></div>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>
            </div>
            <div class="findres">
                <div class="bl_code">W12345678915</div>
                <div class="bl_code">W12345678915</div>
                <div class="bl_code">W12345678915</div>
                <div class="bl_code">W12345678915</div>
                <div class="bl_code">W12345678915</div>
                <div class="bl_code">W12345678915</div>
            </div>
            </form>
        </div>
        <!-- 邀请码状况跟踪管控 -->
        <div class="content_nav">
                <div class="content_navl"><span><i
                            class="layui-icon layui-icon-home"></i>首页&nbsp;&nbsp;</span>/<span>&nbsp;会员管理&nbsp;&nbsp;</span>/&nbsp;邀请码状态跟踪
                </div>
                <div class="content_navi">
                    <form class="layui-form" action="">
                        <div class="layui-container-fluid">
                            <div class="layui-fluid">
                                <div class="layui-row">
                                    <div class="layui-col-sm3">
                                        <div class="grid-demo grid-demo-bg1">
                                            <label for="">推荐单位/人：
                                                <div>
                                                    <select id="yishu" name="modules" lay-verify="required" lay-search="">
                                                        <option value="">请选择</option>
                                                        <!-- <option value="1">layer</option>
                                                                        <option value="2">form</option>
                                                                        <option value="3">layim</option> -->
                                                    </select>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="layui-col-sm3">
                                            <div class="grid-demo grid-demo-bg1">
                                                <label for="">邀请码：
                                                    <div>
                                                        <input type="text" placeholder="邀请码" style="border-radius: 6px;">
                                                    </div>
                                                </label>
                                            </div>
                                        </div>
                                    <div class="layui-col-sm3">
                                        <div class="grid-demo grid-demo-bg1">
                                            <label for="">状态：
                                                <div >
                                                    <select id="yishu" name="modules" lay-verify="required" lay-search="">
                                                        <option value="">请选择</option>
                                                        <!-- <option value="1">layer</option>
                                                                            <option value="2">form</option>
                                                                            <option value="3">layim</option> -->
                                                    </select>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="layui-col-sm3">
                                        <div class="hy_btn">
                                            <button type="button" class="layui-btn layui-btn-normal">查询</button>
                                            <div class="clear"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                </div>
                <div class="findres2">
                    <table class="layui-table" lay-skin="line">
                        <colgroup>
                            <col width="150">
                            <col width="200">
                            <col>
                        </colgroup>
                        <thead>
                            <tr class="tatou">
                                <th>序号</th>
                                <th>推荐类型</th>
                                <th>单位类型</th>
                                <th>单位名称</th>
                                <th>发展名额数</th>
                                <th>邀请码</th>
                                <th>状态</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>会员单位推荐</td>
                                <td>全国文艺家协会</td>
                                <td>中国剧协</td>
                                <td>7</td>
                                <td>W15675493535</td>
                                <td style="color: skyblue">已申领</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>会员单位推荐</td>
                                <td>全国文艺家协会</td>
                                <td>中国剧协</td>
                                <td>7</td>
                                <td>W15675493535</td>
                                <td style="color: skyblue">已申领</td>
                            </tr>
                        </tbody>
                    </table>
                    <div>
                        <div id="shuju5"></div>
                    </div>
                </div>
                </form>
            </div>
        <!--会员邀请状态跟踪  -->
        <div class="content_nav">
                <div class="content_navl"><span><i
                            class="layui-icon layui-icon-home"></i>首页&nbsp;&nbsp;</span>/<span>&nbsp;会员管理&nbsp;&nbsp;</span>/&nbsp;会员邀请状态跟踪
                </div>
                <div class="content_navi">
                    <form class="layui-form" action="">
                        <div class="layui-container-fluid">
                            <div class="layui-fluid">
                                <div class="layui-row">
                                    <div class="layui-col-sm3">
                                        <div class="grid-demo grid-demo-bg1">
                                            <label for="">发展年份：
                                                <div style="display: inline-block">
                                                    <select id="yishu" name="modules" lay-verify="required" lay-search="">
                                                        <option value="">请选择</option>
                                                        <!-- <option value="1">layer</option>
                                                                        <option value="2">form</option>
                                                                        <option value="3">layim</option> -->
                                                    </select>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="layui-col-sm3">
                                        <div class="grid-demo grid-demo-bg1">
                                            <label for="">推荐单位：
                                                <div style="display: inline-block">
                                                    <select id="yishu" name="modules" lay-verify="required" lay-search="">
                                                        <option value="">请选择</option>
                                                        <!-- <option value="1">layer</option>
                                                                            <option value="2">form</option>
                                                                            <option value="3">layim</option> -->
                                                    </select>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="layui-col-sm3 layui-col-md-offset3">
                                        <div class="hy_btn">
                                            <button type="button" class="layui-btn layui-btn-normal">查询</button>
                                            <div class="clear"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                </div>
                <div class="findres2">
                    <table class="layui-table" lay-skin="line">
                        <colgroup>
                            <col width="150">
                            <col width="200">
                            <col>
                        </colgroup>
                        <thead>
                            <tr class="tatou">
                                <th>单位名称</th>
                                <th>发展目标/th>
                                <th>剩余名额</th>
                                <th>审核通过</th>
                                <th>完成比例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>中国剧协</td>
                                <td>20</td>
                                <td>8</td>
                                <td>7</td>
                                <td>20%</td>
                            </tr>
                            <tr>
                                <td>中国剧协</td>
                                <td>20</td>
                                <td>8</td>
                                <td>7</td>
                                <td>30%</td>
                            </tr>
                        </tbody>
                    </table>
                    <div>
                        <div id="shuju6"></div>
                    </div>
                </div>
                </form>
            </div>
    </div>
    <div class="cover5">
		<div class="tcc_content">
			<div class="tcc_title">修改分配情况</div>
			<div class="findfile hnzw">
				发展名额数：<input type="text" id="fzmes_z">
			</div>
			<div class="findfile_an">
					<button type="button" class="layui-btn layui-btn-normal" id="fzmesqd_z"onclick="fzmesqd_z()">确定</button>
				<button type="button" class="layui-btn layui-btn-primary" onclick="close1()">关闭</button>
			</div>
		</div>
	</div>

    <script src="./layui/layui.js"></script>
    <script src="./js/layuicommon2.js"></script>
    <script src="./js/jquery.min.js"></script>
    <script src="./js/header.js"></script>
    <script src="./js/common.js"></script>
    <script src="./js/commonheader.js"></script>
    <script src="./js/InvitationCode_z.js"></script>
	<script>
        let treedata = [];
        let ind1;
        function close1() {
			$(".cover5").css( "display", "none");
        }
        function chuxian(){
            $("#test1").css( "visibility", "visible");	
        }
        $('#qkqk').click(function(){
            $('#time1').val('');
            $('#time2').val('');
        })
		$('.headerpage').html(commHeader.header);
        $('.content_nav').eq(0).show().siblings().hide();
        $(".tatou").css({ "background-color": "#059afe", "color": "white" });
        $('.hytitle_font').click(function () {
            var i = $(this).index();
            $('.hytitle_font').css("border-bottom", "");
            $('.hytitle_font').eq(i).css("border-bottom", "solid");
            $('.content_nav').eq(i).show().siblings().hide();
        });
        $('#test1').mouseleave(function(){
			$('#test1').css("visibility", "hidden");
		})
        var data = {
        }
        base.commonAjax('clav/recommendUnit/getAllUnitList', data, function (data) {
            if (data.code == 1) {
                //console.log("z", data);
                treelocaldata = data.data;
                wtf(data.data);
               // console.log(treedata)
                layui.use('tree', function () {
                    var tree = layui.tree;

                    //渲染
                    var inst1 = tree.render({
                        elem: '#test1'  //绑定元素
                        ,click: function(obj){
                       // console.log(obj.data); //得到当前点击的节点数据
                       // console.log(obj.elem); //得到当前节点元素 
                        // console.log($('.layui-tree-set').attr("data-id"));
                      //  console.log(obj.data.id); //得到当前点击的节点数据
                        let str = obj.data.id;
                       // let strss = str.indexOf('-');
                        if(String(str).indexOf('-') != -1){
							 
                             let arr = str.split('-');
                             if(arr.length == 2){
                                 console.log(treelocaldata[Number(arr[0])].childList[Number(arr[1])]);
                                 ind1 = treelocaldata[Number(arr[0])].childList[Number(arr[1])].id;
                                 title1 = treelocaldata[Number(arr[0])].childList[Number(arr[1])].name;
                                //console.log(ind1,title1)
                                $('#sanjit').val(title1);
                                $('#test1').css("visibility","hidden");
                                 }
                                 if(arr.length == 3){
                                 console.log(treelocaldata[Number(arr[0])].childList[Number(arr[1])].childList[Number(arr[2])]);
                                 ind1 = treelocaldata[Number(arr[0])].childList[Number(arr[1])].childList[Number(arr[2])].id;
                                 title1 = treelocaldata[Number(arr[0])].childList[Number(arr[1])].childList[Number(arr[2])].name;
                                //console.log(ind1,title1)
                                $('#sanjit').val(title1);
                                $('#test1').css("visibility","hidden");
                                 }
                             } else {
                                 let arr = str;
                                 console.log(arr);
                                 console.log(treelocaldata[arr]);
                                 ind1 = treelocaldata[arr].id;
                                 title1 = treelocaldata[arr].name;
                                 //console.log(title1)
                                 $('#sanjit').val(title1);
                                 $('#test1').css("visibility","hidden");
                             }
                    }
                        , data:treedata
                    });
                    
                });
            }
        });
        function wtf(data) {
            data.map((v, i) => {
                let obj = {};
                obj.title = v.name;
                obj.id = i;
                obj.children = [];
                v.childList.map((val, ind) => {
                    let objc = {};
                    objc.title = val.name;
                    objc.id = i+'-'+ind;
                    objc.children = [];
                    val.childList.map((vv, ii) => {
                        let objcc = {};
                        objcc.title = vv.name;
                        objcc.id = i+'-'+ind + '-' + ii;
                        objc.children.push(objcc);
                    })
                    obj.children.push(objc);
                });
                treedata.push(obj);
            });
        }
        layui.use('form', function(){
          var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功
       form.on('select(fznf_z)',function(data){
        fznf_z=data.value;
           //mz3=data.elem[data.elem.selectedIndex].text;
           form.render('select');
       })
    })
   function qrfp_z(){
    //console.log("提交",ind1)
    var startTime=$('#time1').val();
    var endTime=$('#time2').val();
    var placeCount=$('#fzmees_z').val();
    var data={
        startTime:startTime,
        endTime:endTime,
        year:fznf_z,
        units:ind1,
        placeCount:placeCount
    }
    //console.log("提交",data)
    base.commonAjax('clav/allotInfo/addDevelopPlace', data, function (data) {
        if(data.code==1){
            alert('分配成功')
            codelist_z();
        }
    })
   }
   
   </script>
</body>

</html>