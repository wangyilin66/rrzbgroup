<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>理事调整</title>
    <link rel="stylesheet" href="./layui/css/layui.css">
    <link rel="stylesheet" href="./css/hyfind.css">
    <link rel="stylesheet" href="./css/header.css">
    <link rel="stylesheet" href="./css/yyui.css">
    <style>
          #zyzgl{
        border-bottom: 5px solid rgba(147, 209, 255,1);
    }
        .content {
            height: auto;
            box-sizing: border-box;
        }

        .content_nav {
            width: 90%;
            position: relative;
            box-sizing: border-box;
        }

        .c_cont {
            margin-top: 30px;
            width: 100%;
            /* padding-left: 100px; */
            display: flex;
            box-sizing: border-box;
        }

        .lis {
            box-sizing: border-box;
            margin-left: 140px;

        }

        .lis>p {
            font-size: 14px;
            float: left;
            line-height: 32px;
        }

        .mq {
            font-size: 18px;
            font-weight: 800;
        }

        .lis_r {
            float: left;
            width: 200px;
            margin-left: 20px;
            box-sizing: border-box;
        }

        #test8 {
            width: 300px;
            height: 32px;
        }

        .textinp {
            width: 300px;
            height: 30px;
            border: 0;
            padding-left: 8px;
            box-sizing: border-box;
            border-radius: 6px;
        }

        #areabox {
            width: 500px;
            height: 50px;
            border: 0;
            resize: none;
            padding-left: 8px;
            padding-top: 4px;
            box-sizing: border-box;
        }

        .butbox {
            width: 137px;
            height: 28px;
            display: flex;
            margin: 0 auto;
        }

        .jumpnext {
            width: 74px;
            height: 28px;
            background: #3196FE;
            border-radius: 4px;
            text-align: center;
            line-height: 28px;
            font-weight: 600;
            color: #fff;
            cursor: pointer;
        }

        .beback {
            width: 47px;
            height: 28px;
            background: #3196FE;
            margin-left: 16px;
            border-radius: 4px;
            text-align: center;
            line-height: 28px;
            font-weight: 600;
            color: #fff;
            cursor: pointer;
        }

        .cont_b {
            width: 100%;
            margin-top: 168px;
        }

        /* .chide {
            display: none;
        } */
         .zyzgl{
        border-bottom: 5px solid #93D1FF;
    }
    </style>
</head>

<body>
    <!-- 头部 -->
    <!-- <div class="headerpage">

    </div> -->
    <header></header>
    <!-- 内容 -->
    <div class="hytitle">

    </div>
    <div class="content">
        <div class="content_nav">
            <div class="content_navl"><span><i
                        class="layui-icon layui-icon-home"></i>首页&nbsp;&nbsp;</span>/<span>&nbsp;志愿者管理&nbsp;&nbsp;</span>/&nbsp;理事调整
            </div>
            <div class="content_navi">
                <form class="layui-form" action="">

                    <div class="c_cont">
                        <div class="lis">
                            <p class="mq">免去理事姓名：</p>
                            <div class="lis_r">
                                <select class="inp" id="nameinp"  lay-filter="mqlsinp" lay-verify="required" lay-search="">
                                    <option value="">请选择</option>
                                    <!-- <option value="1">layer</option>
                                    <option value="2">form</option> -->
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="c_cont chide">
                        <div class="lis">
                            <p>性别：</p>
                            <div class="lis_r">
                                <select class="inp" id="sexinp"  lay-filter="sexinp" lay-verify="required" lay-search="">
                                    <option value="1">男</option>
                                    <option value="2">女</option>
                                </select>
                            </div>
                        </div>
                        <div class="lis">
                            <p>出生年月：</p>
                            <div class="lis_r">
                                <!-- <input type="text" class="layui-input" id="test8"> -->
                                <input type="text" class="textinp" name="date" id="time1" lay-verify="date"
                                    placeholder="请选择时间">
                            </div>
                        </div>
                        <div class="lis">
                            <p>联系方式：</p>
                            <div class="lis_r">
                                <input type="text" id="phoneinp" class="textinp">
                            </div>
                        </div>
                    </div>
                    <div class="c_cont chide">
                        <div class="lis">
                            <p>职务：</p>
                            <div class="lis_r">
                                <textarea name="" id="areabox" placeholder="职务" id="" cols="30" rows="10"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="c_cont chide">
                        <div class="lis">
                            <p class="mq">新增理事姓名：</p>
                            <div class="lis_r">
                                <input type="text" class="textinp" id="newnameinp">
                            </div>
                        </div>
   
                    </div>
                    <div class="c_cont chide">
                    <div class="lis">
                        <p>身份证号：</p>
                        <div class="lis_r">
                            <input type="text" class="textinp" id="newsfz">
                        </div>
                    </div>
                </div>
                </form>
                <div class="cont_b">
                    <div class="butbox">
                        <div class="jumpnext">下一步</div>
                        <div class="beback">返回</div>
                    </div>
                </div>
            </div>

        </div>
    </div>



    <script src="./layui/layui.js"></script>
    <script src="./js/layuicommon.js"></script>
    <script src="./js/jquery.min.js"></script>
    <script src="./js/header.js"></script>
    <script src="./js/common.js"></script>
    <script src="./js/hyfind.js"></script>
    <script src="./js/commonheader.js"></script>
    <script>
        $('.chide').hide();
        let mqls,sex,userId;
        let data = {

        };
        let objdata,ajaxdata;
        //$('.headerpage').html(commHeader.header);
        		// 引的头部
		$('header').load('./headerys.html');

        layui.use('laydate', function () {
            var laydate = layui.laydate;

            //执行一个laydate实例
            laydate.render({
                elem: '#test1' //指定元素
            });
        });
     let sfzF = false;
        $('#newsfz').on('keyup', function () {

            let len = $(this).val().length;
            console.log(len);
            if (len == 15 || len == 18) {
                $('.sfztit').text('');
                sfzF = true;
            } else {
                $('.sfztit').text('身份证格式错误');
                sfzF = false;
            }
        });

        $('.jumpnext').on('click', function () {
            if($('#newnameinp').val() != '' && $('#newsfz').val() != ''){
                if(!sfzF){
                    layui.use('layer', function () {
                            var layer = layui.layer;
                            layer.msg('请输入正确的身份证号码');
                           
                        });
                        return;
                }
                base.commonAjax('clav/lishiReplace/theClavMemberIsExit', {idNumber:$('#newsfz').val(),name:$('#newnameinp').val()}, function (res) {
               console.log(res);
               if(res.code == 1){
                  if(res.isExit == 1){
                    sessionStorage.setItem('sfzid',$('#newsfz').val());
                      sessionStorage.setItem('sfzname',$('#newnameinp').val());
                    window.location.href = "addUserPage_w.html?id="+res.data.id+'&rid='+userId;
                  }else{
                      window.location.href = "addUserPage_w.html";
                      sessionStorage.setItem('sfzid',$('#newsfz').val());
                      sessionStorage.setItem('sfzname',$('#newnameinp').val());
                  }
               }
                });

               // window.location.href = "addUserPage_w.html";

            }else{
                alert('请填写新增姓名和身份证号')
            }
           
        })
        $('.beback').on('click', function () {
            window.location.href = "tjVipFindPage.html";
        });


        
        base.commonAjax('clav/lishiReplace/getLiShiList', data, function (res) {
            console.log(res);
            if(res.code == 1){
                ajaxdata = res.data;
                console.log(ajaxdata);
             res.data.map(function(item,ind){
               $('#nameinp').append(' <option value="'+ind+'">'+item.name+'</option>');
             });
            }else{
                console.log("理事列表获取失败");
            }
        });

        
        //获取URL数据  
        function getQueryString() {

            var url = location.search; //获取url中"?"符后的字串
            var theRequest = new Object();
            if (url.indexOf("?") != -1) {
                var str = url.substr(1);
                strs = str.split("&");
                for (var i = 0; i < strs.length; i++) {
                    theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
                }
            }
            return theRequest;
        }

            setTimeout(function () {
                let idss = getQueryString('id').id;
                console.log(idss);
                if (idss) {
                    ajaxdata.map(function (v, inds) {
                        if (v.id == idss) {
                            layui.use('form', function () {
                                var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功
                                let idnumber = sessionStorage.getItem('sfzid');
                                let idname = sessionStorage.getItem('sfzname');
                                console.log(idname,idnumber);
                                $('.chide').show();
                                $('#sexinp').val(v.gender);
                                //console.log(inds);
                                $('#nameinp').val(inds);
                                $('#time1').val(v.birthday);
                                $('#phoneinp').val(v.phone);
                                $('#areabox').val(v.unitAndDuty);
                                $('#newnameinp').val(idname);
                                $('#newsfz').val(idnumber);
                                form.render('select');
                            });
                        }
                    });
                }
            }, 500);


            layui.use('form', function () {
        var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功
        form.on('select(mqlsinp)', function (data) {
           // tj = data.value;
           mqls=data.elem[data.elem.selectedIndex].text;
           //console.log(data.value);
           objdata = ajaxdata[Number(data.value)];
           $('#sexinp').val(objdata.gender);
           $('#time1').val(objdata.birthday);
           $('#phoneinp').val(objdata.phone);
           $('#areabox').val(objdata.unitAndDuty);
           console.log(objdata);
           userId = objdata.id;
           $('.chide').show();
            form.render('select');
        });
        form.on('select(sexinp)', function (data) {
            sex = data.value;
            //mz3=data.elem[data.elem.selectedIndex].text;
            form.render('select');
        })
    });

    </script>
</body>

</html>