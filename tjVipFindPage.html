<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>会员查询</title>
	<link rel="stylesheet" href="./layui/css/layui.css">
	<link rel="stylesheet" href="./css/hyfind.css">
    <link rel="stylesheet" href="./css/header.css">
    <link rel="stylesheet" href="./css/yyui.css">
	<style>
          #zyzgl{
        border-bottom: 5px solid rgba(147, 209, 255,1);
    }
        .zyzgl{
            border-bottom: 5px solid #93D1FF;
        }
        .tatou{
            margin-top: 30px !important;
        }
        .c_n_lis{
            width: 100%;
            display: flex;
            margin-top: 20px;
            position: relative;
        }
        .n_l_butbox{
        position: absolute;
        right:0;
        top:30px;
        display: flex;
        }
        .n_l_butbox>div, .n_l_butbox>button{
            width: 102px;
            height: 32px;
            text-align: center;
            line-height: 32px;
            background: #0084FF;
            color: #fff;
            margin-left: 15px;
            border-radius: 6px;
            border:0;
            cursor:pointer;
        }
        .clearinp{
            background: #848A8D !important;
          
        }
        .zb{
            width: 130px !important;
        }
        
        .n_l_cont{
            margin-right: 50px;
        }
        .n_l_cont2{
            margin-left:22px;
        }
        .n_l_cont > p{
         font-size: 14px;
         flex-wrap: 600;
         line-height: 30px;
        }
        .nameinp,.nubmerinp{
            width: 286px;
            height: 32px;
            border:0;
            border-radius: 6px;
            padding-left: 12px;
        }
        .l_c_box{
			width: 272px;
			display: flex;
		}
		.layui-icon-table,.layui-icon-refresh-3{
			width: 30px !important;
			height: 28px;
			display: block;
			text-align: center;
			font-size: 20px;
			padding: 0 4px;
			background: #fff;
			line-height: 30px;
			cursor:pointer;
			border:1px solid #ccc;
		}
		.layui-icon-refresh-3{
		font-size: 16px;
		padding: 0 6px;
		}
		.c_b_tits{
			display: block;
			width: 30px;
			height: 27px;
			margin-top: 1px;
			text-align: center;
			line-height: 30px;
			background: #fff;
			padding: 0 8px;
        }
        #layui{

            margin-top: 15px;
            margin-left: 0 !important;

        }
        .obg{
            color: orange;
        }
        .bbg{
            color: skyblue;
        }
        .rbg{
            color: red;
        }
        .layui-btn{
            margin-left: 5px !important;
        }

	</style>
</head>

<body>
	<!-- 头部 -->
	<!-- <div class="headerpage">
	
    </div> -->
    <header></header>
	<!-- 内容 -->
	<div class="hytitle">

	</div>
	<div class="content">
		<div class="content_nav">
			<div class="content_navl"><span><i class="layui-icon layui-icon-home"></i>首页&nbsp;&nbsp;</span>/<span>&nbsp;志愿者管理&nbsp;&nbsp;</span>/&nbsp;推荐会员查询</div>
			<div class="content_navi">
				<form class="layui-form" action="">
                 <div class="c_n_lis">
                     <div class="n_l_cont">
                         <p>会员姓名：</p>
                         <input class="nameinp" type="text"/>
                     </div>
                     <div class="n_l_cont">
                            <p>会员编号：</p>
                            <input class="nubmerinp" type="text"/>
                        </div>
                        <div class="n_l_cont">
                                <p>推荐单位/人：</p>
                                <!-- <input class="nameinp" type="text"/> -->
                                <select class="tjdwinp" lay-filter="tjdwinp" lay-search="">
                                <option value="">请选择</option>
                                <!-- <option value="0">某单位</option>
                                <option value="1">某人</option> -->
                            </select>
                            </div>
                            </div>
                            
                            <div class="c_n_lis">
                                <div class="n_l_cont">
                                    <p>入会时间：</p>
                                    <div class="l_c_box">
                                        <i class="layui-icon layui-icon-table"></i>
                                        <input type="text" name="date" id="time1" lay-verify="date" style="width:122px;display: inline-block"
                                            placeholder="开始时间" autocomplete="off" class="layui-input">
                                        <div class="c_b_tits">至</div>
                                        <input type="text" name="date" id="time2" lay-verify="date" style="width:122px;display: inline-block"
                                            placeholder="结束时间" autocomplete="off" class="layui-input">
                                        <i class="layui-icon layui-icon-refresh-3" id='ctimebox'></i>
                            
                                    </div>
                                </div>

                                <div class="n_l_cont n_l_cont2">
                                        <p>状态：</p>
                                        <select class="ztinp"  lay-filter="ztinp"  lay-search="">
                                                <option value="">请选择</option>
                                                <option value="4">调整中</option>
                                                <option value="5">理事通过</option>
                                                <option value="6">理事不通过</option>
                                                <option value="7">审核中</option>
                                            </select>
                                </div>

                                <div class="n_l_butbox">
                                <div class="zb">增补会员单位</div>
                                <div class="ls">理事调整</div>
                                <div class="chaxun">查询</div>
                                <button type="reset" class="clearinp">清空条件</button>
                                </div>
                            
                            </div>

				</form>
			</div>
			<div class="findres">
			
				<table class="layui-table" lay-skin="line">
					<colgroup>
						<col width="150">
						<col width="200">
						<col>
					</colgroup>
					<thead>
						<tr class="tatou">
							<!-- <th style="width: 50px">
								<input type="checkbox" name="" title="" lay-skin="primary">
							</th> -->
							<th>平台编号</th>
							<th>会员编号</th>
							<th>会员姓名</th>
							<th>入会日期</th>
							<th>推荐单位</th>
							<th>组织身份</th>
							<th>艺术门类</th>
							<th>状态</th>
							<th>操作</th>
						</tr>
					</thead>
					<tbody id='tb'>

					</tbody>
				</table>
				<div>
					<div id="layui"></div>
				</div>
			</div>
		</div>
	</div>


	<script src="./layui/layui.js"></script>
	<!-- <script src="./js/layuicommon.js"></script> -->
	<script src="./js/jquery.min.js"></script>
	<script src="./js/header.js"></script>
	<script src="./js/common.js"></script>
    <script src="./js/commonheader.js"></script>
    <script src="./js/layuicommon2.js"></script> 
	<script>
        let zt,tj,listdate;
        var data = {
        };
        //$('.headerpage').html(commHeader.header);
        		// 引的头部
		$('header').load('./headerys.html');
		$(".tatou").css({ "background-color": "#059afe", "color": "white" });
		// layui.use('laypage', function () {
		// 	var laypage = layui.laypage;

		// 	//执行一个laypage实例
		// 	laypage.render({
		// 		elem: 'shuju' //注意，这里的 test1 是 ID，不用加 # 号
		// 		, count: 5 //数据总数，从服务端得到
		// 		, limit: 1
		// 	});
		// });

        $('.clearinp').on('click',function(){
            tj = false;
            zt = false;
            $('.nameinp').val('');
            $('.nubmerinp').val('');
            $('#time1').val('');
            $('#time2').val('');
            $('.ztinp').val('');
            $('.tjdwinp').val('');
        });

        $('.chaxun').on('click',function(){
        let data = {
        }
        let nameinp = $('.nameinp').val();
        let numberinp = $('.nubmerinp').val();
        let sinp = $('#time1').val();
        let einp = $('#time2').val();
        console.log(tj,zt,nameinp,numberinp,sinp,einp);
        if(tj){
            data.relationshipGroup = tj;
        }
        if(zt){
            data.auditStatus = zt;
        }
        if(nameinp != ''){
            data.name = nameinp;
        }
        if(numberinp != ''){
            data.memberNo = numberinp;
        }
        if(sinp != ''){
            data.sTime = sinp;
        }
        if(einp != ''){
            data.eTime = einp;
        }
    
        console.log(data);
        // let dat = {
        //   name : nameinp,
        //   memberNo:numberinp,
        //   relationshipGroup:tj,
        //   sTime:sinp,
        //   eTime:einp,
        //   auditStatus:zt
        // };
        base.commonAjax('clav/lishiReplace/getLiShiMemberList', data, function (data) {
             console.log(data.data);
            let ll = data.data.length;
         if(data.code == 1){
          
         if(ll != 0){
            var pagedata = [];
				console.log(data);
				pagedata = data.data;
				console.log(pagedata);
                listdate = pagedata;
				//调用分页
				layui.use(['laypage', 'layer'], function () {
					var laypage = layui.laypage
						, layer = layui.layer;

					laypage.render({
						elem: 'layui'
						, count: pagedata.length,
						layout: ['count', 'prev', 'page', 'next', 'limit', 'skip'],
						limit: 10,
						jump: function (obj) {
							//模拟渲染
							document.getElementById('tb').innerHTML = function () {
								var arr = []
									, thisData = pagedata.concat().splice(obj.curr * obj.limit - obj.limit, obj.limit);
								layui.each(thisData, function (index, item) {
									arr.push(auto(item,index));
									//console.log(item);
								});
								return arr.join('');
							}();
						}
					});
				});
         }
         }else{
             console.log('查询接口出错');
         }

        });
    });
        function changepic(obj) {
            //console.log(obj.files[0]);//这里可以获取上传文件的name
            var newsrc = getObjectURL(obj.files[0]);
            document.getElementById('show').src = newsrc;
        }
        //建立一個可存取到該file的url
        function getObjectURL(file) {
            var url = null;
            // 下面函数执行的效果是一样的，只是需要针对不同的浏览器执行不同的 js 函数而已
            if (window.createObjectURL != undefined) { // basic
                url = window.createObjectURL(file);
            } else if (window.URL != undefined) { // mozilla(firefox)
                url = window.URL.createObjectURL(file);
            } else if (window.webkitURL != undefined) { // webkit or chrome
                url = window.webkitURL.createObjectURL(file);
            }
            return url;
        }


        

        base.commonAjax('clav/lishiReplace/getRecommendUnitOrPeopleList', data, function (res) {
           console.log(res);
           if(res.code == 1){
            res.data.map(function(item,ind){
                $('.tjdwinp').append('<option value="'+ind+'">'+item+'</option>');
            })
           }else{
               console.log('推荐单位/人列表获取失败');
           }
        }); 

			//调用分页
			base.commonAjax('clav/lishiReplace/getLiShiMemberList', data, function (data) {
				var pagedata = [];
				console.log(data);
				pagedata = data.data;
                console.log(pagedata);
                listdate = pagedata;

				//调用分页
				layui.use(['laypage', 'layer'], function () {
					var laypage = layui.laypage
						, layer = layui.layer;

					laypage.render({
						elem: 'layui'
						, count: pagedata.length,
						layout: ['count', 'prev', 'page', 'next', 'limit', 'skip'],
						limit: 10,
						jump: function (obj) {
							//模拟渲染
							document.getElementById('tb').innerHTML = function () {
								var arr = []
									, thisData = pagedata.concat().splice(obj.curr * obj.limit - obj.limit, obj.limit);
								layui.each(thisData, function (index, item) {
									arr.push(auto(item,index));
									//console.log(item);
								});
								return arr.join('');
							}();
						}
					});
				});
			});
	
	$('.zb').on('click',function () { 

        var data = {
            timeType:2
        }
        base.commonAjax('clav/scheduleTime/isScheduleTime', data, function (res) {
        console.log(res);

        if(res.code == 1){
         if(res.isInfo == 1){
             alert('申报时间未开始');
         }else if(res.isInfo == 2){
            alert('申报已结束');
         }else{
            window.location.href = "addvipPage_w.html";
         }
        }else{
            console.log('增补权限获取失败');
        }
        

        });

    });

        $('.ls').on('click', function () {
            var data = {
                timeType: 1
            }
            base.commonAjax('clav/scheduleTime/isScheduleTime', data, function (res) {
                console.log(res);

                if (res.code == 1) {
                    if (res.isInfo == 1) {
                        alert('申报时间未开始');
                    } else if (res.isInfo == 2) {
                        alert('申报已结束');
                    } else {
                        window.location.href = "removeUserPage_w.html";
                    }
                } else {
                    console.log('增补权限获取失败');
                }

            });
        });

$('#ctimebox').on('click',function () { 
    $('#time1').val('');
    $('#time2').val('');
 })

	layui.use('form', function(){
          var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功
        form.on('select(tjdwinp)', function (data) {
            form.render('select');
        });
	});

    function removevip(ind) { 
         console.log(listdate[ind]);
         let data = {
             id:listdate[ind].id
         }
         base.commonAjax('clav/lishiReplace/deleteNewLiShi', data, function (res) {
            if(res.code == 1){
                history.go(0);
            }else{
            alert('删除失败');
            }
         });
     }

     function xgbut(ind) { 
         console.log(listdate[ind]);
         window.location.href = "newvip2_z.html?id="+listdate[ind].id;
      }

     function xgbut2(ind) { 
         console.log(listdate[ind]);
         window.location.href = "newvip3_z.html?id="+listdate[ind].id;
      }

	function auto(obj,ind){
        console.log(obj);
        let str = '';
        let str2 = '';
        if(obj.auditStatus == 4){
            str = '<span class="obg">调整中</span>';
            str2 = '<button class="layui-btn"  onclick="xgbut('+ind+')">修改</button>';
        }else if(obj.auditStatus == 5){
            str = '<span class="bbg">理事通过</span>';
            str2 = '<button class="layui-btn" onclick="xgbut('+ind+')">修改</button><button class="layui-btn layui-btn-normal"   onclick="xgbut2('+ind+')">查看</button>'
        }else if(obj.auditStatus == 6){
            str = '<span class="rbg">理事不通过</span>';
            str2 = '<button class="layui-btn layui-btn-danger"  onclick="removevip('+ind+')">删除</button>';

        }else if(obj.auditStatus == 7){
            str == '<span class="obg">审核中</span>';
            str2 = '<button class="layui-btn layui-btn-normal">查看</button>';
        }
		return '<tr>' +
				'<td>' + (ind+1) + '</td>' +
				'<td>' + obj.memberNo + '</td>' +
				'<td>' + obj.name + '</td>' +
				'<td>' + obj.createDate + '</td>' +
				'<td>' + obj.relationshipGroup + '</td>' +
				'<td>' + obj.orgIdentityStr + '</td>' +
				'<td>' + obj.artStr + '</td>' +
				'<td>' + str + '</td>' +
				'<td>' +str2 +
				// '<button class="layui-btn">编辑</button>' +
				// '<button class="layui-btn layui-btn-normal">查看</button>' +
				// '<button class="layui-btn layui-btn-normal">导出</button>' +
				// '<button class="layui-btn layui-btn-warm">移除</button>' +
				// '<button class="layui-btn layui-btn-danger">重置密码</button>' +
				'</td>' +
				'</tr>'
	}

    layui.use('laydate', function(){
   var laydate = layui.laydate;
   //日期
   laydate.render({
   elem: '#date'
    });
    laydate.render({
   elem: '#date1' 
    });
function useLayDateMultiple(cls) {
      layui.use('laydate', function() {
   var laydate = layui.laydate;

      lay('#' + cls).each(function() {
      laydate.render({
   elem : this
   ,trigger : 'click'
   ,format: 'yyyy/MM/dd HH:mm:ss'
      ,done: function(value, datetime, endDate){
   timechecked=value;
   bjtime1=timechecked.split(/\s+/)[0].replace(/\//g, "");
        console.log(bjtime1);
   }
      });
      });
      });
}
   
function useLayDateMultiple2(cls) {
      layui.use('laydate', function() {
      var laydate = layui.laydate;
      lay('#' + cls).each(function() {
      laydate.render({
      elem : this,
   trigger : 'click'
   ,format: 'yyyy/MM/dd HH:mm:ss'
      ,done: function(value, datetime, endDate){
   timechecked2=value;
   bjtime2=timechecked2.split(/\s+/)[0].replace(/\//g, "");
        console.log(bjtime2);
      }
      });
      });
      });
   }   
useLayDateMultiple('time1'); useLayDateMultiple2('time2');

 });


    layui.use('form', function () {
        var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功
        form.on('select(tjdwinp)', function (data) {
           // tj = data.value;
           tj=data.elem[data.elem.selectedIndex].text;
            form.render('select');
        });
        form.on('select(ztinp)', function (data) {
            zt = data.value;
            //mz3=data.elem[data.elem.selectedIndex].text;
            form.render('select');
        })
    });



	</script>
</body>

</html>