<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>增补会员单位</title>
	<link rel="stylesheet" href="./layui/css/layui.css">
	<link rel="stylesheet" href="./css/hyfind.css">
	<link rel="stylesheet" href="./css/header.css">
	<style>
		     .content{
            height: 1080px;
        }
		.cont_bg{
			
		}
		.content_navl{
			background-color: #eceff4;
			width: 102%;
			margin-left: -2px;
			padding-bottom: 29px;
		}
		.content_nav{
			margin-top: 42px;
			width: 80%;
			background: #fff;
			height: auto;
		}
		.tit{
			margin-left: 30px;
			margin-top: 28px;
			font-size: 20px;
			color: #408BE2;
			font-weight: 600;
		}
		.textbox{
			width: 79.4%;
			height: 160px;
			background: #0081FF;
			color: #fff;
			border-radius: 16px;
			margin-left: 28px;
			margin-top: 16px;
			box-sizing: border-box;
			padding-top: 2px;
		}

		.textbox > ul > li{
			font-size: 16px;
			margin-left: 20px;
			margin-top: 4px;
		}
		.cont_li{
			width: 100%;
			box-sizing: border-box;
			padding-left: 28px;
			padding-right: 96px;
			display: flex;
			justify-content:space-between;
			line-height: 32px;
			margin-top: 20px;
		}
		.dwtitle{
			width: 270px;
			height: 32px;
			border:2px solid #E4E4E4;
			padding-left: 12px;
			box-sizing: border-box;
		}
		.sp{
			color: red;
			margin-right: 4px;
		}
		.pp{
			margin-right: 8px;
			width: 110px;
			text-align: right;
		}
		.c_l_right{
			display: flex;
		}
		.c_l_left{
			display: flex;
		}
		.c_l_inp{
			width: 230px;
			height: 32px;
			border:2px solid #E4E4E4;
			padding-left: 12px;
			box-sizing: border-box;
		}
		.upfile{
			width: 37px;
			height: 32px;
			z-index: 9;
           opacity: 0;
           cursor:pointer;
		}
		.layui-icon-upload{
           width: 37px;
           height: 32px;
           background: #EEEDEB;
           /* border: 2px solid #E4E4E4; */
           border-left: 0;
           text-align: center;
           line-height: 30px;
           font-size: 18px;
           margin-left: -37px;
           z-index: 1;
	   }
	   .upload{
		   width: 72px;
		   height: 32px;
		   background: #0280FC;
		   font-size: 16px;
		   color: #fff;
		   text-align: center;
		   line-height: 32px;
		   cursor:pointer;
		   border-radius: 6px;
	   }
	   .findres{
		   padding:0 !important;
	   }
	</style>
</head>

<body>
	<!-- 头部 -->
	<div class="headerpage">
			<div class="layui-container-fluid">
				<div class="layui-fluid">
					<div class="layui-row layui-col-space5">
						<div class="layui-col-md5" style="padding-right: 0px;">
							<div class="wltop">
								<div class="logo">
									<img src="./img/admin_logo.png" alt="">
								</div>
							</div>
						</div>
						<div class="layui-col-md7" style="padding-left: 0px;">
							<ul class="layui-nav layui-bg-blue tou">
								<li class="layui-nav-item layui-this"><a href="">首页</a></li>
								<li class="layui-nav-item">
									<a href="javascript:;">志愿者管理</a>
									<dl class="layui-nav-child">
										 
											<dd><a href="addvipPage_w.html">增补会员单位</a></dd>
											<dd><a href="addVipPage1_w.html">添加文艺志愿者1</a></dd>
											<dd><a href="addVipPage2_w.html">添加文艺志愿者2</a></dd>
									</dl>
								</li>
								<li class="layui-nav-item">
									<a href="javascript:;">组织管理</a>
									<dl class="layui-nav-child">
										<dd><a href="">移动模块</a></dd>
										<dd><a href="">后台模版</a></dd>
										<dd><a href="">电商平台</a></dd>
									</dl>
								</li>
								<li class="layui-nav-item">
									<a href="javascript:;">活动管理</a>
									<dl class="layui-nav-child">
										<dd><a href="">移动模块</a></dd>
										<dd><a href="">后台模版</a></dd>
										<dd><a href="">电商平台</a></dd>
									</dl>
								</li>
								<li class="layui-nav-item">
									<a href="javascript:;">会员管理</a>
									<dl class="layui-nav-child">
										<dd><a href="vipfind_z.html">会员查询</a></dd>
										<dd><a href="./vipcheck_z.html">审核管理</a></dd>
										<dd><a href="./recommendedUnits_z.html">推荐单位管理</a></dd>
										<dd><a href="./tjVipFindPage.html">推荐会员管理</a></dd>
										<dd><a href="./vipduty_z.html">会员职位管理</a></dd>
										<dd><a href="./InvitationCode_z.html">邀请码管理</a></dd>
										<dd><a href="managementPage_w.html">通知管理</a></dd>
										<dd><a href="dataFind_w.html">会员信息统计</a></dd>
										<dd><a href="">会费管理</a></dd>
									</dl>
								</li>
								<li class="layui-nav-item">
									<a href="javascript:;">系统管理</a>
									<dl class="layui-nav-child">
										<dd><a href="">移动模块</a></dd>
										<dd><a href="">后台模版</a></dd>
										<dd><a href="">电商平台</a></dd>
									</dl>
								</li>
								<li class="layui-nav-item">
									<a href="javascript:;">统计报表</a>
									<dl class="layui-nav-child">
										<dd><a href="">移动模块</a></dd>
										<dd><a href="">后台模版</a></dd>
										<dd><a href="">电商平台</a></dd>
									</dl>
								</li>
								<li class="layui-nav-item"><a href="">系统管理员</a></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	<!-- 内容 -->

	<div class="content">
		<div class="content_nav">
			<div class="content_navl"><span><i class="layui-icon layui-icon-home"></i>首页&nbsp;&nbsp;</span>/<span>&nbsp;志愿者管理&nbsp;&nbsp;</span>/&nbsp;增补会员单位</div>
	        <div class="cont_bg">
			<div class="content_navi">
				<h3 class="tit">注意事项：</h3>
				<div class="textbox">
                 <ul>
					 <li>副省级城市以上文艺志愿者协会，可申请增补为会员单位。申请材料为：</li>
					 <li>1，由本级文联组织出具的申请书；</li>
					 <li>2，本单位情况介绍，需说明成立时间，发起单位，经费来源，主席团成员介绍，理事和会员名册，工作机构和联系方式；</li>
					 <li>3，协会章程；</li>
					 <li>4，相关资质证明，由当地民政部门颁发的社团证或党委宣传部的同意成立批准文件。</li>
					 <li>5，请务必检查申请材料完成度，在点击提交，审核期间不得修改。</li>
				 </ul>
				</div>
				<form class="layui-form" action="">
                <div class="cont_li">
					<div class="c_l_left">
							<p class="pp"><span class="sp">*</span>申报单位名称：</p>
							<input type="text" class="dwtitle" placeholder="请填写申报单位名称"/>
					</div>
					<div class="c_l_right">
						<p class="pp"><span class="sp">*</span>申请书：</p>
						<input type="text" class="c_l_inp sqtext" placeholder="点击选择文件"/>
						<input type="file" id='sqinp' class='upfile' onchange="sqschangepic(this)"/>
						<i class="layui-icon layui-icon-upload"></i>  
					</div>
				</div>

				<div class="cont_li">
						<div class="c_l_left">
								<p class="pp"><span class="sp">*</span>协会章程：</p>
						<input type="text" class="c_l_inp zctext" placeholder="点击选择文件"/>
						<input type="file" id='zcinp' class='upfile'  onchange="zcchangepic(this)"/>
						<i class="layui-icon layui-icon-upload"></i>  
						</div>
						<div class="c_l_right">
							<p class="pp"><span class="sp">*</span>单位情况介绍：</p>
							<input type="text" class="c_l_inp jstext" placeholder="点击选择文件"/>
							<input type="file" id='jsinp' class='upfile'  onchange="jschangepic(this)"/>
							<i class="layui-icon layui-icon-upload"></i>  
						</div>
					</div>

					<div class="cont_li">
							<div class="c_l_left">
									<p class="pp"><span class="sp">*</span>资质证明：</p>
									<input type="text" class="c_l_inp zztext" placeholder="点击选择文件"/>
									<input type="file" id='zzinp' class='upfile'  onchange="zzchangepic(this)"/>
									<i class="layui-icon layui-icon-upload"></i>  
							</div>
							<div class="c_l_right">
								<div class="upload">提交</div>
							</div>
						</div>

				</form>
			</div>

			<div class="findres">
				<table class="layui-table" lay-skin="line">
					<colgroup>
						<col width="150">
						<col width="200">
						<col>
					</colgroup>
					<thead>
						<tr class="tatou">

							<th>平台编号</th>
							<th>会员编号</th>
							<th>会员姓名</th>
							<th>入会日期</th>
							<th>推荐单位</th>
							<th>组织身份</th>
							<th>艺术门类</th>
							<th>地域</th>
							<th>操作</th>
						</tr>
					</thead>
					<tbody id='tb'>

					</tbody>
				</table>
				<div>

					<div id="layui"></div>
					<div></div>
					<div></div>
				</div>
			</div>
		</div>
		</div>
	</div>


	<script src="./layui/layui.js"></script>
	<script src="./js/layuicommon.js"></script>
	<script src="./js/jquery.min.js"></script>
	<script src="./js/header.js"></script>
	<script src="./js/common.js"></script>
	<script src="./js/hyfind.js"></script>
	<script>
		$(".tatou").css({ "background-color": "#059afe", "color": "white" });
		// layui.use('laypage', function () {
		// 	var laypage = layui.laypage;

		// 	//执行一个laypage实例
		// 	laypage.render({
		// 		elem: 'shuju' //注意，这里的 test1 是 ID，不用加 # 号
		// 		, count: 5 //数据总数，从服务端得到
		// 		, limit: 1
		// 	});
		// });


	var data = {

	}


	let sqs = null,zc = null,js = null,zz = null;

	function sqschangepic(obj) {
            //console.log(obj.files[0]);//这里可以获取上传文件的name
            var newsrc = getObjectURL(obj.files[0]);
			sqs = newsrc;
			$('.sqtext').val(newsrc);
		}
		function zcchangepic(obj) {
            //console.log(obj.files[0]);//这里可以获取上传文件的name
            var newsrc = getObjectURL(obj.files[0]);
			zc = newsrc;
			$('.zctext').val(newsrc);
		}
		function jschangepic(obj) {
            //console.log(obj.files[0]);//这里可以获取上传文件的name
            var newsrc = getObjectURL(obj.files[0]);
		   js = newsrc;
		   $('.jstext').val(newsrc);
		}
		function zzchangepic(obj) {
            //console.log(obj.files[0]);//这里可以获取上传文件的name
            var newsrc = getObjectURL(obj.files[0]);
			zz = newsrc;
			$('.zztext').val(newsrc);
		}
		
        //建立一個可存取到該file的url
        function getObjectURL(file) {
            var url = null;
            // 下面函数执行的效果是一样的，只是需要针对不同的浏览器执行不同的 js 函数而已
            if (window.createObjectURL != undefined) { // basic
                url = window.createObjectURL(file);
            } else if (window.URL != undefined) { // mozilla(firefox)
                url = window.URL.createObjectURL(file);
            } else if (window.webkitURL != undefined) { // webkit or chrome
                url = window.webkitURL.createObjectURL(file);
            }
            return url;
		}
		
		$('.upload').on('click',function () { 
			let sqs2 = null,zc2 = null,js2 = null,zz2 = null,dwname;
			dwname = $('.dwtitle').val();
			console.log(dwname);
           if(sqs == null){
			   alert('请上传申请书');
			} else {
				var file = $("#sqinp")[0].files[0];
				var formData = new FormData();
				formData.append("file", file);
					$.ajax({
						type: "post",
						url: base.baseurl + 'clav/upload/uploadFile',
						data: formData,
						cache: false,
						processData: false,
						contentType: false,
						success: function (res) {
							console.log(res);
						 if(res.code == 1){
                          sqs2 = res.data[0].url;
						 }else{
							 console.log('申请书上传失败');
						 }
						}

					});
			}
			if (zc == null) {
				alert('请上传协会章程');
			}else {
				var file = $("#zcinp")[0].files[0];
				var formData = new FormData();
				formData.append("file", file);
					$.ajax({
						type: "post",
						url: base.baseurl + 'clav/upload/uploadFile',
						data: formData,
						cache: false,
						processData: false,
						contentType: false,
						success: function (res) {
							console.log(res);
						 if(res.code == 1){
                          zc2 = res.data[0].url;
						 }else{
							 console.log('协会章程上传失败');
						 }
						}

					});
			}
			if (js == null) {
				alert('请上传单位情况介绍');
			}else {
				var file = $("#jsinp")[0].files[0];
				var formData = new FormData();
				formData.append("file", file);
					$.ajax({
						type: "post",
						url: base.baseurl + 'clav/upload/uploadFile',
						data: formData,
						cache: false,
						processData: false,
						contentType: false,
						success: function (res) {
							console.log(res);
						 if(res.code == 1){
                          js2 = res.data[0].url;
						 }else{
							 console.log('单位情况介绍上传失败');
						 }
						}

					});
			}
			if (zz == null) {
				alert('请上传资质证明');
			}else {
				var file = $("#zzinp")[0].files[0];
				var formData = new FormData();
				formData.append("file", file);
					$.ajax({
						type: "post",
						url: base.baseurl + 'clav/upload/uploadFile',
						data: formData,
						cache: false,
						processData: false,
						contentType: false,
						success: function (res) {
							console.log(res);
						 if(res.code == 1){
						  zz2 = res.data[0].url;
						 }else{
								console.log('资质证明上传失败');
							}
						}

					});
			}
				
			setTimeout(() => {
				if (dwname != null && sqs2 != null && zc2 != null && js2 != null && zz2 != null) {
					let data = {
						unitName: dwname,
						applicationBook: sqs2,
						unitSituation: js2,
						aptitudeProve: zz2,
						associationRule: zc2,
					}
					base.commonAjax('clav/memberUnit/addClavMemberUnit', data, function (res) {
						console.log(res);
						if(res.code == 1){
							alert('上传成功');
						}else{
							alert('上传失败');
						}
					});

				} else {
					alert("请填写单位名称。");
				}
			}, 2000);

		
		})

		

		base.commonAjax('clav/member/getClavMemberList', data, function (data) {
			var pagedata = [];
			console.log(data);
			pagedata = data.data;
			//console.log(pagedata)

			//调用分页
			layui.use(['laypage', 'layer'], function () {
				var laypage = layui.laypage
					, layer = layui.layer;

				laypage.render({
					elem: 'layui'
					, count: pagedata.length,
					layout: ['count', 'prev', 'page', 'next', 'skip'],
					limit: 5,
					jump: function (obj) {
						//模拟渲染
						document.getElementById('tb').innerHTML = function () {
							var arr = []
								, thisData = pagedata.concat().splice(obj.curr * obj.limit - obj.limit, obj.limit);
							layui.each(thisData, function (index, item) {
								arr.push(auto(item));
								console.log(item);
							});
							return arr.join('');
						}();
					}
				});
			});
		});



	function auto(obj){
		return '<tr>' +
				'<td>' + 123 + '</td>' +
				'<td>' + obj.memberNo + '</td>' +
				'<td>' + obj.name + '</td>' +
				'<td>' + obj.createDate + '</td>' +
				'<td>' + obj.recommendType + '</td>' +
				'<td>' + obj.orgIdentityId + '</td>' +
				'<td>' + obj.artTypeId + '</td>' +
				'<td>' + obj.location + '</td>' +
				'<td>' +
				'<button class="layui-btn">编辑</button>' +
				'<button class="layui-btn layui-btn-normal">查看</button>' +
				'<button class="layui-btn layui-btn-normal">导出</button>' +
				'<button class="layui-btn layui-btn-warm">移除</button>' +
				'<button class="layui-btn layui-btn-danger">重置密码</button>' +
				'</td>' +
				'</tr>'
	}







	</script>
</body>

</html>